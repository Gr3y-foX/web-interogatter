# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–±–æ—Ä–∫–æ–π Docker –Ω–∞ Raspberry Pi

## –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ Docker –æ–±—Ä–∞–∑–∞

–ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ Docker –∑–∞–≤–∏—Å–ª–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ–±—Ä–∞–∑–∞ `python:3.11-slim-bullseye`, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è Raspberry Pi –∏–∑-–∑–∞:
- –ú–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ë–æ–ª—å—à–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞ (~100MB+)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

## ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd ~/web-interogatter/raspberry-production
./fix_docker_build.sh
```

–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é **6** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —à–∞–≥–∏) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

#### 1. –ü—Ä–µ—Ä–≤–∞—Ç—å –∑–∞–≤–∏—Å—à—É—é —Å–±–æ—Ä–∫—É

```bash
# –ù–∞–∂–º–∏—Ç–µ Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω–∞ —Å–±–æ—Ä–∫–∞
# –ò–ª–∏ –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
docker ps -q | xargs docker stop
docker system prune -f
```

#### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–±–æ—Ä–∫—É

```bash
cd ~/web-interogatter/raspberry-production
./raspberry-run.sh fix-build
```

#### 3. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏

```bash
./raspberry-run.sh build
```

## üöÄ –ß—Ç–æ –±—ã–ª–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

1. **–ë–æ–ª–µ–µ –ª–µ–≥–∫–∏–π –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑**: `python:3.9-slim-bullseye` –≤–º–µ—Å—Ç–æ `3.11` (–º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä)
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è apt**: –¥–æ–±–∞–≤–ª–µ–Ω `--no-install-recommends` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
3. **BuildKit**: –≤–∫–ª—é—á–µ–Ω –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–£–±—Ä–∞–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ**: —É–¥–∞–ª–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `version` –∏–∑ docker-compose

## üìã –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–∞—è

#### –í–∞—Ä–∏–∞–Ω—Ç A: –°–±–æ—Ä–∫–∞ –±–µ–∑ –∫—ç—à–∞ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –Ω–∞–¥–µ–∂–Ω–µ–µ)

```bash
./raspberry-run.sh build-no-cache
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –∑–∞—Ä–∞–Ω–µ–µ
docker pull python:3.9-slim-bullseye

# –ó–∞—Ç–µ–º —Å–æ–±—Ä–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
./raspberry-run.sh build
```

#### –í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ Docker Registry —Å –≥–æ—Ç–æ–≤—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏ –¥–ª—è ARM64, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –Ω–∞–ø—Ä—è–º—É—é.

### –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω) - —á–∞—Å—Ç–æ –±—ã—Å—Ç—Ä–µ–µ
2. **–°–æ–±–µ—Ä–∏—Ç–µ –Ω–∞ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–π –º–∞—à–∏–Ω–µ** –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑:
   ```bash
   # –ù–∞ –º–æ—â–Ω–æ–π –º–∞—à–∏–Ω–µ
   docker build -t web-interceptor:raspberry -f Dockerfile.raspberry .
   docker save web-interceptor:raspberry | gzip > web-interceptor.tar.gz
   
   # –ù–∞ Raspberry Pi
   gunzip -c web-interceptor.tar.gz | docker load
   ```

## ‚è±Ô∏è –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏

- **–ë—ã—Å—Ç—Ä—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (10+ Mbps)**: 5-10 –º–∏–Ω—É—Ç
- **–°—Ä–µ–¥–Ω–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (1-10 Mbps)**: 15-30 –º–∏–Ω—É—Ç
- **–ú–µ–¥–ª–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç (<1 Mbps)**: 30-60+ –º–∏–Ω—É—Ç

**–°–æ–≤–µ—Ç**: –û—Å—Ç–∞–≤—å—Ç–µ —Å–±–æ—Ä–∫—É —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ, –æ–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

–í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Docker
docker ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏
sudo iftop -i eth0  # –∏–ª–∏ wlan0

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏
docker compose -f docker-compose.raspberry.yml build --progress=plain
```

## üõ†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Docker daemon

```bash
sudo nano /etc/docker/daemon.json
```

–î–æ–±–∞–≤—å—Ç–µ:
```json
{
  "max-concurrent-downloads": 2,
  "max-concurrent-uploads": 2
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker:
```bash
sudo systemctl restart docker
```

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ swap (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –ø–∞–º—è—Ç–∏)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π swap
free -h

# –ï—Å–ª–∏ swap –º–∞–ª–µ–Ω—å–∫–∏–π, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å
sudo dphys-swapfile swapoff
sudo nano /etc/dphys-swapfile  # –£–≤–µ–ª–∏—á—å—Ç–µ CONF_SWAPSIZE
sudo dphys-swapfile setup
sudo dphys-swapfile swapon
```

## üìû –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É:
   ```bash
   ping -c 4 8.8.8.8
   curl -I https://hub.docker.com
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ:
   ```bash
   df -h
   docker system df
   ```

3. –û—á–∏—Å—Ç–∏—Ç–µ Docker:
   ```bash
   docker system prune -a
   ```

4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π –º–∞—à–∏–Ω–µ –∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–±—Ä–∞–∑ (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç C –≤—ã—à–µ)

## ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Å–±–æ—Ä–∫–∏

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
./raspberry-run.sh start
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
```bash
./raspberry-run.sh status
```

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ –≤—Å–µ–≥–¥–∞ —Å–∞–º–∞—è –º–µ–¥–ª–µ–Ω–Ω–∞—è. –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏ –±—É–¥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É Docker.
